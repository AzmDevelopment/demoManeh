{
  "certificationId": "lithium_battery_local_products",
  "title": "Lithium Battery - Local Products",
  "workflows": {
    "new_application": {
      "name": "New Certificate Application",
      "initialStep": "data_entry",
      "steps": [
        {
          "id": "data_entry",
          "name": "Applicant Data Entry",
          "actor": "applicant",
          "fields": ["category", "product", "measuringUnit", "density", "costPrice", "expectedSalePrice", "vatCategory"],
          "validations": ["validate_product_required", "validate_numeric_fields"],
          "nextStep": "document_upload",
          "canSendBack": false
        },
        {
          "id": "document_upload",
          "name": "Document Upload",
          "actor": "applicant",
          "fields": ["technical_specs", "test_reports", "manufacturer_certificate"],
          "validations": ["validate_all_documents"],
          "nextStep": "initial_review",
          "canSendBack": true,
          "sendBackTarget": "data_entry"
        },
        {
          "id": "initial_review",
          "name": "Initial Review",
          "actor": "inspector",
          "fields": ["review_notes", "inspection_result"],
          "validations": ["validate_inspection_complete"],
          "nextStep": "conditional_path",
          "canSendBack": true,
          "sendBackTarget": "document_upload"
        },
        {
          "id": "conditional_path",
          "name": "Path Decision",
          "actor": "system",
          "type": "auto_decision",
          "conditions": [
            {
              "if": "inspection_result == 'pass' && category == 'CAT001'",
              "then": "technical_evaluation"
            },
            {
              "if": "inspection_result == 'pass' && category != 'CAT001'",
              "then": "final_approval"
            },
            {
              "if": "inspection_result == 'fail'",
              "then": "rejection"
            }
          ]
        },
        {
          "id": "technical_evaluation",
          "name": "Technical Evaluation",
          "actor": "senior_engineer",
          "fields": ["technical_score", "engineer_remarks"],
          "validations": ["validate_technical_score"],
          "nextStep": "final_approval",
          "canSendBack": true,
          "sendBackTarget": "initial_review"
        },
        {
          "id": "final_approval",
          "name": "Final Approval",
          "actor": "certification_manager",
          "fields": ["approval_decision", "approval_notes"],
          "validations": ["validate_approval_decision"],
          "nextStep": "certificate_generation",
          "canSendBack": true,
          "sendBackTarget": "technical_evaluation"
        },
        {
          "id": "certificate_generation",
          "name": "Generate Certificate",
          "actor": "system",
          "type": "auto_process",
          "nextStep": "completed"
        },
        {
          "id": "completed",
          "name": "Certificate Issued",
          "actor": "system",
          "status": "completed"
        },
        {
          "id": "rejection",
          "name": "Application Rejected",
          "actor": "system",
          "status": "rejected"
        }
      ]
    },
    "renewal": {
      "name": "Certificate Renewal",
      "inheritsFrom": "new_application",
      "initialStep": "renewal_check",
      "steps": [
        {
          "id": "renewal_check",
          "name": "Check Renewal Eligibility",
          "actor": "system",
          "type": "auto_check",
          "conditions": [
            {
              "if": "days_until_expiry <= 90 && days_until_expiry > 0",
              "then": "renewal_data_entry"
            },
            {
              "if": "days_until_expiry > 90",
              "then": "renewal_too_early"
            },
            {
              "if": "days_until_expiry <= 0",
              "then": "renewal_expired"
            }
          ]
        },
        {
          "id": "renewal_data_entry",
          "name": "Update Information",
          "actor": "applicant",
          "fields": ["product", "costPrice", "expectedSalePrice"], // Fewer fields than new
          "validations": ["validate_price_changes"],
          "nextStep": "renewal_review",
          "canSendBack": false
        },
        {
          "id": "renewal_review",
          "name": "Quick Review",
          "actor": "inspector",
          "fields": ["review_notes", "renewal_approved"],
          "validations": ["validate_renewal_approval"],
          "nextStep": "renewal_decision",
          "canSendBack": true,
          "sendBackTarget": "renewal_data_entry"
        },
        {
          "id": "renewal_decision",
          "name": "Renewal Decision",
          "actor": "system",
          "type": "auto_decision",
          "conditions": [
            {
              "if": "renewal_approved == true",
              "then": "certificate_generation"
            },
            {
              "if": "renewal_approved == false",
              "then": "rejection"
            }
          ]
        },
        {
          "id": "renewal_too_early",
          "name": "Renewal Not Allowed Yet",
          "actor": "system",
          "status": "rejected_early",
          "message": "Renewal can only be done within 90 days of expiry"
        },
        {
          "id": "renewal_expired",
          "name": "Certificate Expired - New Application Required",
          "actor": "system",
          "status": "rejected_expired",
          "message": "Certificate has expired. Please submit a new application."
        }
      ]
    },
    "suspension": {
      "name": "Certificate Suspension",
      "initialStep": "suspension_request",
      "steps": [
        {
          "id": "suspension_request",
          "name": "Request Suspension",
          "actor": "certificate_holder",
          "fields": ["suspension_reason", "suspension_start_date", "suspension_duration"],
          "validations": ["validate_suspension_dates"],
          "nextStep": "suspension_approval",
          "canSendBack": false
        },
        {
          "id": "suspension_approval",
          "name": "Approve Suspension",
          "actor": "certification_manager",
          "fields": ["approval_status", "manager_notes"],
          "validations": ["validate_approval_status"],
          "nextStep": "suspension_implementation",
          "canSendBack": true,
          "sendBackTarget": "suspension_request"
        },
        {
          "id": "suspension_implementation",
          "name": "Implement Suspension",
          "actor": "system",
          "type": "auto_process",
          "nextStep": "suspended"
        },
        {
          "id": "suspended",
          "name": "Certificate Suspended",
          "actor": "system",
          "status": "suspended"
        }
      ]
    },
    "amendment": {
      "name": "Certificate Amendment",
      "initialStep": "amendment_request",
      "steps": [
        {
          "id": "amendment_request",
          "name": "Request Amendment",
          "actor": "certificate_holder",
          "fields": ["amendment_type", "amendment_details", "supporting_documents"],
          "validations": ["validate_amendment_type"],
          "nextStep": "amendment_review",
          "canSendBack": false
        },
        {
          "id": "amendment_review",
          "name": "Review Amendment",
          "actor": "technical_committee",
          "fields": ["review_outcome", "committee_notes", "additional_requirements"],
          "validations": ["validate_review_outcome"],
          "nextStep": "amendment_approval",
          "canSendBack": true,
          "sendBackTarget": "amendment_request"
        },
        {
          "id": "amendment_approval",
          "name": "Approve Amendment",
          "actor": "certification_manager",
          "fields": ["final_approval", "effective_date"],
          "validations": ["validate_final_approval"],
          "nextStep": "certificate_amended",
          "canSendBack": true,
          "sendBackTarget": "amendment_review"
        },
        {
          "id": "certificate_amended",
          "name": "Certificate Amended",
          "actor": "system",
          "status": "amended"
        }
      ]
    }
  },
  
  // Common validation rules referenced by workflows
  "validationRules": {
    "validate_product_required": {
      "type": "custom",
      "function": "checkProductRequired",
      "message": "Product is mandatory for this category"
    },
    "validate_numeric_fields": {
      "type": "pattern",
      "pattern": "^[0-9]+\\.?[0-9]*$",
      "message": "Must be a valid number"
    },
    "validate_inspection_complete": {
      "type": "required",
      "fields": ["inspection_result", "review_notes"],
      "message": "Inspection must be completed with notes"
    }
  }
}